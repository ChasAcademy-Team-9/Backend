<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Package Tracking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-align: center;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #0078d4;
            padding-bottom: 10px;
        }

        .section {
            margin-bottom: 40px;
        }

        .btn {
            background: #0078d4;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #005a9e;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .status {
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #0078d4;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px;
            font-style: italic;
        }

        .welcome-message {
            text-align: center;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .demo-badge {
            background: #17a2b8;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üì¶ Package Tracking System</h1>

        <div class="welcome-message">
            <h2>üéâ V√§lkommen till Package Tracking System!</h2>
            <p>Detta √§r en demonstration av v√•rt paketsp√•rningssystem. Systemet visar f√∂rare, paket och loggar fr√•n v√•r
                databas.</p>
            <p><strong>Status:</strong> <span id="system-status">Kontrollerar system...</span></p>
        </div>

        <!-- Database Status -->
        <div class="section">
            <h2>üîç System Status</h2>
            <button class="btn" onclick="checkHealth()">Kontrollera databas-status</button>
            <div id="health-status"></div>
        </div>

        <!-- Drivers Section -->
        <div class="section">
            <h2>üë®‚Äçüíº F√∂rare (Drivers) <span class="demo-badge" id="drivers-badge" style="display:none">DEMO</span></h2>
            <button class="btn" onclick="loadDrivers()">üîÑ Ladda f√∂rare</button>
            <div id="drivers-content">
                <div class="loading">Klicka "Ladda f√∂rare" f√∂r att visa data...</div>
            </div>
        </div>

        <!-- Packages Section -->
        <div class="section">
            <h2>üì¶ Paket <span class="demo-badge" id="packages-badge" style="display:none">DEMO</span></h2>
            <button class="btn" onclick="loadPackages()">üîÑ Ladda paket</button>
            <div id="packages-content">
                <div class="loading">Klicka "Ladda paket" f√∂r att visa data...</div>
            </div>
        </div>

        <!-- Logs Section -->
        <div class="section">
            <h2>üìã Loggar <span class="demo-badge" id="logs-badge" style="display:none">DEMO</span></h2>
            <button class="btn" onclick="loadLogs()">üîÑ Ladda loggar</button>
            <div id="logs-content">
                <div class="loading">Klicka "Ladda loggar" f√∂r att visa data...</div>
            </div>
        </div>

        <!-- Senders Section -->
        <div class="section">
            <h2>üì§ S√§ndare (Senders) <span class="demo-badge" id="senders-badge" style="display:none">DEMO</span></h2>
            <button class="btn" onclick="loadSenders()">üîÑ Ladda s√§ndare</button>
            <div id="senders-content">
                <div class="loading">Klicka "Ladda s√§ndare" f√∂r att visa data...</div>
            </div>
        </div>

        <!-- Receivers Section -->
        <div class="section">
            <h2>üì• Mottagare (Receivers) <span class="demo-badge" id="receivers-badge" style="display:none">DEMO</span>
            </h2>
            <button class="btn" onclick="loadReceivers()">üîÑ Ladda mottagare</button>
            <div id="receivers-content">
                <div class="loading">Klicka "Ladda mottagare" f√∂r att visa data...</div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="status-messages"></div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let isDemoMode = false;

        // Health Check with fallback
        async function checkHealth() {
            const statusDiv = document.getElementById('health-status');
            const systemStatus = document.getElementById('system-status');
            statusDiv.innerHTML = '<div class="loading">Kontrollerar databasanslutning...</div>';

            try {
                const response = await fetch(`${API_BASE}/api/health`, { timeout: 5000 });
                const data = await response.json();

                if (response.ok) {
                    statusDiv.innerHTML = `<div class="status success">‚úÖ Databas ansluten: ${data.database}</div>`;
                    systemStatus.innerHTML = '‚úÖ Live system - ansluten till databas';
                    isDemoMode = false;
                } else {
                    throw new Error('Database connection failed');
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status info">‚ÑπÔ∏è API √§r inte tillg√§ngligt. Systemet k√∂rs i demo-l√§ge med exempel-data.</div>`;
                systemStatus.innerHTML = 'üé® Demo-l√§ge - visar exempel-data';
                isDemoMode = true;
                showDemoMessage();
            }
        }

        // Show demo message
        function showDemoMessage() {
            const demoDiv = document.createElement('div');
            demoDiv.className = 'status info';
            demoDiv.innerHTML = `
                <h3>üé® Demo-l√§ge aktiverat</h3>
                <p>Backend API:et √§r inte tillg√§ngligt f√∂r tillf√§llet, men du kan se hur systemet kommer att fungera med exempel-data.</p>
            `;
            document.getElementById('status-messages').appendChild(demoDiv);
        }

        // Load Drivers with demo fallback
        async function loadDrivers() {
            const contentDiv = document.getElementById('drivers-content');
            const badge = document.getElementById('drivers-badge');
            contentDiv.innerHTML = '<div class="loading">Laddar f√∂rare...</div>';

            if (isDemoMode) {
                showDemoDrivers(contentDiv, badge);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/drivers`);
                const data = await response.json();

                if (response.ok && data.drivers) {
                    badge.style.display = 'none';
                    if (data.drivers.length === 0) {
                        contentDiv.innerHTML = '<div class="empty-state">Inga f√∂rare hittades</div>';
                    } else {
                        let tableHTML = createDriversTable(data.drivers);
                        contentDiv.innerHTML = tableHTML;
                    }
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                showDemoDrivers(contentDiv, badge);
            }
        }

        // Create drivers table HTML
        function createDriversTable(drivers) {
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>F√∂rnamn</th>
                            <th>Efternamn</th>
                            <th>Anv√§ndarnamn</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            drivers.forEach(driver => {
                tableHTML += `
                    <tr>
                        <td>${driver.DriverID}</td>
                        <td>${driver.FirstName}</td>
                        <td>${driver.LastName}</td>
                        <td>${driver.UserName}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            return tableHTML;
        }

        // Show demo drivers
        function showDemoDrivers(contentDiv, badge) {
            badge.style.display = 'inline';
            const demoDrivers = [
                { DriverID: 1, FirstName: 'Anna', LastName: 'Andersson', UserName: 'anna.a' },
                { DriverID: 2, FirstName: 'Erik', LastName: 'Eriksson', UserName: 'erik.e' },
                { DriverID: 3, FirstName: 'Maria', LastName: 'Johansson', UserName: 'maria.j' },
                { DriverID: 4, FirstName: 'Lars', LastName: 'Larsson', UserName: 'lars.l' }
            ];

            contentDiv.innerHTML = createDriversTable(demoDrivers);
        }

        // Load Packages with demo fallback
        async function loadPackages() {
            const contentDiv = document.getElementById('packages-content');
            const badge = document.getElementById('packages-badge');
            contentDiv.innerHTML = '<div class="loading">Laddar paket...</div>';

            if (isDemoMode) {
                showDemoPackages(contentDiv, badge);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/packages`);
                const data = await response.json();

                if (response.ok && data.packages) {
                    badge.style.display = 'none';
                    if (data.packages.length === 0) {
                        contentDiv.innerHTML = '<div class="empty-state">Inga paket hittades</div>';
                    } else {
                        contentDiv.innerHTML = createPackagesTable(data.packages);
                    }
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                showDemoPackages(contentDiv, badge);
            }
        }

        // Show demo packages
        function showDemoPackages(contentDiv, badge) {
            badge.style.display = 'inline';
            const demoPackages = [
                { PackageID: 'PKG001', Status: 'I transit', CreatedAt: new Date(), DriverID: 1 },
                { PackageID: 'PKG002', Status: 'Delivered', CreatedAt: new Date(Date.now() - 86400000), DriverID: 2 },
                { PackageID: 'PKG003', Status: 'Pending', CreatedAt: new Date(), DriverID: 3 }
            ];

            contentDiv.innerHTML = createPackagesTable(demoPackages);
        }

        // Create packages table
        function createPackagesTable(packages) {
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Paket ID</th>
                            <th>Status</th>
                            <th>Skapad</th>
                            <th>F√∂rare ID</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            packages.forEach(pkg => {
                tableHTML += `
                    <tr>
                        <td>${pkg.PackageID || 'N/A'}</td>
                        <td>${pkg.Status || 'N/A'}</td>
                        <td>${pkg.CreatedAt ? new Date(pkg.CreatedAt).toLocaleString('sv-SE') : 'N/A'}</td>
                        <td>${pkg.DriverID || 'N/A'}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            return tableHTML;
        }

        // Load Logs with demo fallback
        async function loadLogs() {
            const contentDiv = document.getElementById('logs-content');
            const badge = document.getElementById('logs-badge');
            contentDiv.innerHTML = '<div class="loading">Laddar loggar...</div>';

            if (isDemoMode) {
                showDemoLogs(contentDiv, badge);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/logs`);
                const data = await response.json();

                if (response.ok && data.logs) {
                    badge.style.display = 'none';
                    if (data.logs.length === 0) {
                        contentDiv.innerHTML = '<div class="empty-state">Inga loggar hittades</div>';
                    } else {
                        contentDiv.innerHTML = createLogsTable(data.logs);
                    }
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                showDemoLogs(contentDiv, badge);
            }
        }

        // Show demo logs
        function showDemoLogs(contentDiv, badge) {
            badge.style.display = 'inline';
            const demoLogs = [
                { Id: 1, Level: 'info', Message: 'System started successfully', Timestamp: new Date() },
                { Id: 2, Level: 'info', Message: 'Package PKG001 created', Timestamp: new Date(Date.now() - 3600000) },
                { Id: 3, Level: 'warn', Message: 'Database connection slow', Timestamp: new Date(Date.now() - 7200000) },
                { Id: 4, Level: 'info', Message: 'Package PKG002 delivered', Timestamp: new Date(Date.now() - 86400000) }
            ];

            contentDiv.innerHTML = createLogsTable(demoLogs);
        }

        // Create logs table
        function createLogsTable(logs) {
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Niv√•</th>
                            <th>Meddelande</th>
                            <th>Tidsst√§mpel</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            logs.forEach(log => {
                const levelColor = log.Level === 'error' ? '#dc3545' : log.Level === 'warn' ? '#ffc107' : '#28a745';
                tableHTML += `
                    <tr>
                        <td>${log.Id || 'N/A'}</td>
                        <td><span style="color: ${levelColor}; font-weight: bold;">${log.Level || 'N/A'}</span></td>
                        <td>${log.Message || 'N/A'}</td>
                        <td>${log.Timestamp ? new Date(log.Timestamp).toLocaleString('sv-SE') : 'N/A'}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            return tableHTML;
        }

        // Load Senders with demo fallback
        async function loadSenders() {
            const contentDiv = document.getElementById('senders-content');
            const badge = document.getElementById('senders-badge');
            contentDiv.innerHTML = '<div class="loading">Laddar s√§ndare...</div>';

            if (isDemoMode) {
                showDemoSenders(contentDiv, badge);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/senders`);
                const data = await response.json();

                if (response.ok && data.senders) {
                    badge.style.display = 'none';
                    if (data.senders.length === 0) {
                        contentDiv.innerHTML = '<div class="empty-state">Inga s√§ndare hittades</div>';
                    } else {
                        let tableHTML = createSendersTable(data.senders);
                        contentDiv.innerHTML = tableHTML;
                    }
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                showDemoSenders(contentDiv, badge);
            }
        }

        // Create senders table HTML
        function createSendersTable(senders) {
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>F√∂rnamn</th>
                            <th>Efternamn</th>
                            <th>Anv√§ndarnamn</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            senders.forEach(sender => {
                tableHTML += `
                    <tr>
                        <td>${sender.SenderID}</td>
                        <td>${sender.FirstName}</td>
                        <td>${sender.LastName}</td>
                        <td>${sender.UserName}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            return tableHTML;
        }

        // Show demo senders
        function showDemoSenders(contentDiv, badge) {
            badge.style.display = 'inline';
            const demoSenders = [
                { SenderID: 1, FirstName: 'Johan', LastName: 'Svensson', UserName: 'johan.s' },
                { SenderID: 2, FirstName: 'Karin', LastName: 'Nilsson', UserName: 'karin.n' },
                { SenderID: 3, FirstName: 'Peter', LastName: 'Berg', UserName: 'peter.b' }
            ];

            contentDiv.innerHTML = createSendersTable(demoSenders);
        }

        // Load Receivers with demo fallback
        async function loadReceivers() {
            const contentDiv = document.getElementById('receivers-content');
            const badge = document.getElementById('receivers-badge');
            contentDiv.innerHTML = '<div class="loading">Laddar mottagare...</div>';

            if (isDemoMode) {
                showDemoReceivers(contentDiv, badge);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/receivers`);
                const data = await response.json();

                if (response.ok && data.receivers) {
                    badge.style.display = 'none';
                    if (data.receivers.length === 0) {
                        contentDiv.innerHTML = '<div class="empty-state">Inga mottagare hittades</div>';
                    } else {
                        let tableHTML = createReceiversTable(data.receivers);
                        contentDiv.innerHTML = tableHTML;
                    }
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                showDemoReceivers(contentDiv, badge);
            }
        }

        // Create receivers table HTML
        function createReceiversTable(receivers) {
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>F√∂rnamn</th>
                            <th>Efternamn</th>
                            <th>Adress</th>
                            <th>Anv√§ndarnamn</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            receivers.forEach(receiver => {
                tableHTML += `
                    <tr>
                        <td>${receiver.ReceiverID}</td>
                        <td>${receiver.FirstName}</td>
                        <td>${receiver.LastName}</td>
                        <td>${receiver.Adress || 'N/A'}</td>
                        <td>${receiver.UserName}</td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            return tableHTML;
        }

        // Show demo receivers
        function showDemoReceivers(contentDiv, badge) {
            badge.style.display = 'inline';
            const demoReceivers = [
                { ReceiverID: 1, FirstName: 'Sofia', LastName: 'Karlsson', Adress: 'Storgatan 1, Stockholm', UserName: 'sofia.k' },
                { ReceiverID: 2, FirstName: 'Anders', LastName: 'Lindberg', Adress: 'Kungsgatan 10, G√∂teborg', UserName: 'anders.l' },
                { ReceiverID: 3, FirstName: 'Emma', LastName: 'Olsson', Adress: 'Vasagatan 5, Malm√∂', UserName: 'emma.o' }
            ];

            contentDiv.innerHTML = createReceiversTable(demoReceivers);
        }

        // Auto-check health on page load
        window.addEventListener('load', () => {
            checkHealth();
        });
    </script>
</body>

</html>